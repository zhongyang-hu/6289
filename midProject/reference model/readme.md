The used reference code with some modification
